'use strict';

window.debug = require('debug');
var debug = require('debug')('do:example');
var Server = require('lib/server');
var appFactory = require('lib/app');


var app = appFactory();
var app2 = appFactory();
var app3 = appFactory();
var app4 = appFactory();

app.use('/test', app2);

app2.use('', function(req, res, next) {
  debug('app2 route');
});
app2.use('/qwertyu', function(req, res, next) {
  debug('app2 route /qwertyu');
});


// app3.use('/test3', function(req, res, next) {
//   debug('app3 route');
// });

// app4.use('/test4', function(req, res, next) {
//   debug('app4 route');
// });



// app2.use('/test', app3);
// app3.use('/test', app4);

app.use(function(req, res, next) {
  debug('all', req, res);
  next();
});

app.use('/pages', function(req, res, next) {
  debug('/pages1', req, res);
  next();
}, function(req, res) {
  debug('/pages2', req, res);
});


app.use('/pages/:pageId', function(req, res, next) {
  debug('/pages/:pageId1', req, res);
  next();
}, function(req, res, next) {
  debug('/pages/:pageId2', req, res);
});


app.use(function(req, res) {
  debug('not found', req, res);

});



var server = new Server(app);

document.addEventListener('DOMContentLoaded', function() {
  server.run();
}, false);
